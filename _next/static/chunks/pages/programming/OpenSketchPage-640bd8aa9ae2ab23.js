(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8575],{24014:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=r(25441).A},25441:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(14232);function l(e){let{controlled:t,default:r,name:l,state:i="value"}=e,{current:o}=n.useRef(void 0!==t),[s,a]=n.useState(r),c=n.useCallback(e=>{o||a(e)},[]);return[o?t:s,c]}},28009:(e,t,r)=>{"use strict";function n(e,t){"function"==typeof e?e(t):e&&(e.current=t)}r.d(t,{A:()=>n})},30984:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(14232),l=r(98477),i=r(61013),o=r(99351),s=r(28009),a=r(42207);let c=n.forwardRef(function(e,t){let{children:r,container:c,disablePortal:u=!1}=e,[d,h]=n.useState(null),x=(0,o.A)(n.isValidElement(r)?(0,a.A)(r):null,t);return((0,i.A)(()=>{u||h(("function"==typeof c?c():c)||document.body)},[c,u]),(0,i.A)(()=>{if(d&&!u)return(0,s.A)(t,d),()=>{(0,s.A)(t,null)}},[t,d,u]),u)?n.isValidElement(r)?n.cloneElement(r,{ref:x}):r:d?l.createPortal(r,d):d})},53073:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(99351),l=r(22527),i=r(89951),o=r(9113);let s=function(e){let{elementType:t,externalSlotProps:r,ownerState:s,skipResolvingSlotProps:a=!1,...c}=e,u=a?{}:(0,o.A)(r,s),{props:d,internalRef:h}=(0,i.A)({...c,externalSlotProps:u}),x=(0,n.A)(h,u?.ref,e.additionalProps?.ref);return(0,l.A)(t,{...d,ref:x},s)}},76686:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var n=r(14232),l=r(69241),i=r(14065),o=r(77969),s=r(1971),a=r(74275),c=r(37876),u=r(32515),d=r(21376),h=r(28801);let x=(0,r(14457).A)("MuiBox",["root"]),f=(0,d.A)(),y=function(e={}){let{themeId:t,defaultTheme:r,defaultClassName:u="MuiBox-root",generateClassName:d}=e,h=(0,i.Ay)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(o.A);return n.forwardRef(function(e,n){let i=(0,a.A)(r),{className:o,component:x="div",...f}=(0,s.A)(e);return(0,c.jsx)(h,{as:x,ref:n,className:(0,l.A)(o,d?d(u):u),theme:t&&i[t]||i,...f})})}({themeId:h.A,defaultTheme:f,defaultClassName:x.root,generateClassName:u.A.generate})},84215:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var n=r(37876),l=r(14232),i=r(76686),o=r(9092),s=r(80424),a=r(99358),c=r(63734),u=r(75080),d=r(39133),h=r(70451),x=r(24230),f=r(38436),y=r(48069),p=r(70685),m=r(2712),g=r(25858),w=r(64496),A=r(47103);let v=c.A.generator(),C=new u.A;function k(){let e=(0,l.useRef)(null),t=(0,l.useRef)(null),r=(0,l.useRef)(new d.JA),u=(0,l.useRef)(r.current.getArray("shapes")),k=(0,l.useRef)(null),[S,j]=(0,l.useState)([]),[b,E]=(0,l.useState)("select"),[z,P]=(0,l.useState)({x:0,y:0,zoom:1}),[R,M]=(0,l.useState)([]);(0,l.useEffect)(()=>{let e=r.current,t=u.current,n=new h.nS("opensketch-demo-doc",e);n.on("synced",()=>{console.log("OpenSketch loaded from IndexedDB")}),k.current=new d.ad(t);let l=()=>{j(t.toArray())};t.observe(l);let i=e=>{(e.metaKey||e.ctrlKey)&&"z"===e.key&&(e.preventDefault(),e.shiftKey?k.current?.redo():k.current?.undo())};return j(t.toArray()),window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i),t.unobserve(l),n.destroy(),e.destroy()}},[]);let[D,X]=(0,l.useState)(!1),[_,I]=(0,l.useState)(!1),[Y,N]=(0,l.useState)(!1),[L,B]=(0,l.useState)({x:0,y:0}),[W,K]=(0,l.useState)(null);(0,l.useEffect)(()=>{let r=()=>{if(e.current&&t.current){let r=window.devicePixelRatio||1,n=t.current.getBoundingClientRect();e.current.width=n.width*r,e.current.height=n.height*r;let l=e.current.getContext("2d");l&&l.scale(r,r),e.current.style.width=`${n.width}px`,e.current.style.height=`${n.height}px`,O()}};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[S,z]);let O=()=>{if(!e.current)return;let t=e.current.getContext("2d");if(!t)return;let r=e.current.width/(window.devicePixelRatio||1),n=e.current.height/(window.devicePixelRatio||1);t.clearRect(0,0,r,n),t.fillStyle="#f8f9fa",t.fillRect(0,0,r,n),t.save(),t.translate(z.x,z.y),t.scale(z.zoom,z.zoom);let l=c.A.canvas(e.current);C.clear();let i=S.filter(e=>!e.isDeleted).map(e=>({minX:Math.min(e.x,e.x+e.width)-10,minY:Math.min(e.y,e.y+e.height)-10,maxX:Math.max(e.x,e.x+e.width)+10,maxY:Math.max(e.y,e.y+e.height)+10,shape:e}));C.load(i),S.filter(e=>!e.isDeleted).forEach(e=>{if(["rectangle","ellipse","arrow"].includes(e.type)){let t=(e=>{let t={stroke:e.strokeColor,fill:"transparent"!==e.backgroundColor?e.backgroundColor:void 0,fillStyle:e.fillStyle,roughness:e.roughness,strokeWidth:e.strokeWidth};if("draw"===e.type&&e.points&&e.points.length>0||"text"===e.type)return null;switch(e.type){case"rectangle":return v.rectangle(e.x,e.y,e.width,e.height,t);case"ellipse":return v.ellipse(e.x+e.width/2,e.y+e.height/2,e.width,e.height,t);case"arrow":return v.line(e.x,e.y,e.x+e.width,e.y+e.height,t);default:return null}})(e);t&&l.draw(t)}}),S.filter(e=>!e.isDeleted&&"draw"===e.type&&e.points&&e.points.length>0).forEach(e=>{let r=(0,x.$4)(e.points,{size:3*e.strokeWidth,thinning:.5,smoothing:.5,streamline:.5}),n=r.reduce((e,[t,r],n,l)=>{let[i,o]=l[(n+1)%l.length];return e.push(t,r,(t+i)/2,(r+o)/2),e},["M",...r[0],"Q"]);n.push("Z");let l=new Path2D(n.join(" "));t.fillStyle=e.strokeColor,t.fill(l)}),t.textBaseline="top",S.filter(e=>!e.isDeleted&&"text"===e.type&&e.id!==W).forEach(e=>{t.font='24px "Comic Sans MS", "Chalkboard SE", "Comic Neue", sans-serif',t.fillStyle=e.strokeColor,e.text&&e.text.split("\n").forEach((r,n)=>{t.fillText(r,e.x,e.y+28*n)})}),R.forEach(e=>{let r=S.find(t=>t.id===e);if(!r)return;let n=Math.min(r.x,r.x+r.width),l=Math.min(r.y,r.y+r.height),i=Math.abs(r.width),o=Math.abs(r.height);t.strokeStyle="#0d6efd",t.lineWidth=1.5/z.zoom,t.setLineDash([5/z.zoom,5/z.zoom]),t.strokeRect(n-8,l-8,i+16,o+16),t.setLineDash([]),t.fillStyle="#fff";let s=8/z.zoom;t.lineWidth=1.5/z.zoom,[{x:n-8,y:l-8},{x:n+i+8,y:l-8},{x:n-8,y:l+o+8},{x:n+i+8,y:l+o+8}].forEach(e=>{t.fillRect(e.x-s/2,e.y-s/2,s,s),t.strokeRect(e.x-s/2,e.y-s/2,s,s)})}),t.restore()};(0,l.useLayoutEffect)(()=>{O()},[S,z,R]);let T=(t,r)=>{if(!e.current)return{x:0,y:0};let n=e.current.getBoundingClientRect();return{x:(t-n.left-z.x)/z.zoom,y:(r-n.top-z.y)/z.zoom}},$=e=>{D&&(X(!1),e.target.releasePointerCapture(e.pointerId)),Y&&(N(!1),e.target.releasePointerCapture(e.pointerId)),_&&(I(!1),e.target.releasePointerCapture(e.pointerId),E("select"))};return(0,n.jsxs)(i.A,{sx:{width:"100%",height:"calc(100vh - 64px)",position:"relative",overflow:"hidden"},children:[(0,n.jsxs)(o.A,{elevation:4,sx:{position:"absolute",top:16,left:"50%",transform:"translateX(-50%)",display:"flex",gap:1,p:.5,borderRadius:2,zIndex:10},children:[(0,n.jsx)(s.A,{title:"Select",children:(0,n.jsx)(a.A,{color:"select"===b?"primary":"default",onClick:()=>E("select"),children:(0,n.jsx)(f.A,{})})}),(0,n.jsx)(s.A,{title:"Rectangle",children:(0,n.jsx)(a.A,{color:"rectangle"===b?"primary":"default",onClick:()=>E("rectangle"),children:(0,n.jsx)(y.A,{})})}),(0,n.jsx)(s.A,{title:"Ellipse",children:(0,n.jsx)(a.A,{color:"ellipse"===b?"primary":"default",onClick:()=>E("ellipse"),children:(0,n.jsx)(p.A,{})})}),(0,n.jsx)(s.A,{title:"Line",children:(0,n.jsx)(a.A,{color:"arrow"===b?"primary":"default",onClick:()=>E("arrow"),children:(0,n.jsx)(w.A,{})})}),(0,n.jsx)(s.A,{title:"Draw",children:(0,n.jsx)(a.A,{color:"draw"===b?"primary":"default",onClick:()=>E("draw"),children:(0,n.jsx)(m.A,{})})}),(0,n.jsx)(s.A,{title:"Text",children:(0,n.jsx)(a.A,{color:"text"===b?"primary":"default",onClick:()=>E("text"),children:(0,n.jsx)(g.A,{})})}),(0,n.jsx)(i.A,{sx:{borderLeft:"1px solid #ccc",mx:1,my:.5}}),(0,n.jsx)(s.A,{title:"Clear Canvas",children:(0,n.jsx)(a.A,{color:"error",onClick:()=>{u.current.delete(0,u.current.length)},children:(0,n.jsx)(A.A,{})})})]}),(0,n.jsxs)(i.A,{ref:t,sx:{width:"100%",height:"100%",cursor:D?"grabbing":"select"===b?"default":"text"===b?"text":"crosshair",touchAction:"none"},onWheel:t=>{if(t.preventDefault(),t.ctrlKey||t.metaKey){let r=-(.001*t.deltaY),n=Math.max(.1,Math.min(10,z.zoom+r)),l=e.current?.getBoundingClientRect(),i=t.clientX-(l?.left||0),o=t.clientY-(l?.top||0);P(e=>({zoom:n,x:i-(i-e.x)*(n/e.zoom),y:o-(o-e.y)*(n/e.zoom)}))}else P(e=>({...e,x:e.x-t.deltaX,y:e.y-t.deltaY}))},onPointerDown:e=>{if(1===e.button||0===e.button&&e.altKey){X(!0),e.target.setPointerCapture(e.pointerId);return}W&&K(null);let t=T(e.clientX,e.clientY);if("select"===b){let r=C.search({minX:t.x-5,minY:t.y-5,maxX:t.x+5,maxY:t.y+5});if(r.length>0){let n=r[r.length-1].shape;M([n.id]),N(!0),B({x:t.x-n.x,y:t.y-n.y}),e.target.setPointerCapture(e.pointerId)}else M([]);return}if(["rectangle","ellipse","arrow","draw","text"].includes(b)){I(!0);let t=T(e.clientX,e.clientY),r=Math.random().toString(36).substr(2,9),n={id:r,type:b,x:t.x,y:t.y,width:150*("text"===b),height:50*("text"===b),strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",roughness:1,strokeWidth:2,points:"draw"===b?[{x:t.x,y:t.y}]:void 0,text:"text"===b?"":void 0,isDeleted:!1};u.current.push([n]),"text"===b?(K(r),I(!1),E("select")):e.target.setPointerCapture(e.pointerId)}},onPointerMove:e=>{if(D)return void P(t=>({...t,x:t.x+e.movementX,y:t.y+e.movementY}));let t=T(e.clientX,e.clientY);if(Y&&1===R.length){let e=R[0],n=u.current.toArray(),l=n.findIndex(t=>t.id===e);if(-1!==l){let e={...n[l],x:t.x-L.x,y:t.y-L.y};r.current.transact(()=>{u.current.delete(l,1),u.current.insert(l,[e])})}return}if(_&&u.current.length>0){let e=u.current.length-1,n=u.current.get(e),l={...n};"draw"===n.type?l.points=[...n.points||[],{x:t.x,y:t.y}]:(l.width=t.x-n.x,l.height=t.y-n.y),r.current.transact(()=>{u.current.delete(e,1),u.current.insert(e,[l])})}},onPointerUp:$,onPointerCancel:$,children:[(0,n.jsx)("canvas",{ref:e,style:{display:"block",touchAction:"none"}}),W&&(0,n.jsx)(i.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none"},children:(()=>{let e=S.find(e=>e.id===W);if(!e)return null;let t=e.x*z.zoom+z.x,l=e.y*z.zoom+z.y;return(0,n.jsx)("textarea",{autoFocus:!0,style:{position:"absolute",left:t,top:l-2,width:Math.max(150,e.width*z.zoom),minHeight:50,fontFamily:'"Comic Sans MS", "Chalkboard SE", "Comic Neue", sans-serif',fontSize:`${24*z.zoom}px`,lineHeight:1.15,color:e.strokeColor,background:"transparent",border:"1px dashed #0d6efd",outline:"none",resize:"both",padding:0,margin:0,overflow:"hidden",pointerEvents:"auto",transformOrigin:"top left"},value:e.text||"",onChange:t=>{let n=u.current.toArray().findIndex(e=>e.id===W);if(-1!==n){let l={...e,text:t.target.value};r.current.transact(()=>{u.current.delete(n,1),u.current.insert(n,[l])})}},onBlur:()=>K(null)})})()})]})]})}},87102:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/programming/OpenSketchPage",function(){return r(84215)}])}},e=>{e.O(0,[1997,424,8220,6713,636,6593,8792],()=>e(e.s=87102)),_N_E=e.O()}]);